image: node:10.15.1
cache:
  paths:
    - node_modules/
before_script:
 - npm i -g --unsafe-perm now
 - npm i

stages:
  - deploy
  - deploy_live
  - manualDeploy
deploy:
  stage: deploy
  only:
   - staging
  script:
  - now --token=${NOW_TOKEN} -e BASE_URL="https://dev.fluidangle.com"
  - echo "Deploying to now... wait for 60 before setting alias to https://dev.fluidangle.com"
  - now alias --token=${NOW_TOKEN} ${pbpaste} dev.fluidangle.com
deploy_live:
  stage: deploy_live
  only:
   - master
  script:
  - now --token=${NOW_TOKEN}
  - echo "Deploying to now... wait for 60 before setting alias to https://redesign.fluidangle.com"
  - now alias --token=${NOW_TOKEN} redesign.fluidangle.com
manualDeploy:
  stage: manualDeploy
  when: manual
  script:
  - now --token=${NOW_TOKEN} -e BASE_URL="https://test.fluidangle.com"
  - now alias --token=${NOW_TOKEN} ${pbpaste} test.fluidangle.com
